var p=Object.defineProperty;var f=(h,e,t)=>e in h?p(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var i=(h,e,t)=>f(h,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();class m{constructor(e){i(this,"canvas");i(this,"ctx");i(this,"lastTime",0);i(this,"accumulator",0);i(this,"timeStep",1e3/60);i(this,"isRunning",!1);i(this,"currentScene",null);const t=document.getElementById(e);if(!t)throw new Error(`Canvas with id ${e} not found`);this.canvas=t;const s=t.getContext("2d");if(!s)throw new Error("Failed to get 2D context");this.ctx=s,this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}resizeCanvas(){const e=this.canvas.parentElement;e&&(this.canvas.width=e.clientWidth,this.canvas.height=e.clientHeight)}setScene(e){this.currentScene=e,e.init(this)}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),requestAnimationFrame(e=>this.gameLoop(e)))}stop(){this.isRunning=!1}gameLoop(e){if(!this.isRunning)return;const t=e-this.lastTime;for(this.lastTime=e,this.accumulator+=t;this.accumulator>=this.timeStep;)this.update(this.timeStep/1e3),this.accumulator-=this.timeStep;this.render(),requestAnimationFrame(s=>this.gameLoop(s))}update(e){this.currentScene&&this.currentScene.update(e)}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentScene&&this.currentScene.render(this.ctx)}getCanvas(){return this.canvas}getContext(){return this.ctx}}var a=(h=>(h.LEFT="ArrowLeft",h.RIGHT="ArrowRight",h.UP="ArrowUp",h.SPACE=" ",h.R="r",h.ESC="Escape",h))(a||{});const l=class l{constructor(){i(this,"keys",new Map);i(this,"keysPressed",new Map);i(this,"keysReleased",new Map);window.addEventListener("keydown",e=>this.onKeyDown(e)),window.addEventListener("keyup",e=>this.onKeyUp(e))}static getInstance(){return l.instance||(l.instance=new l),l.instance}onKeyDown(e){this.keys.get(e.key)||this.keysPressed.set(e.key,!0),this.keys.set(e.key,!0)}onKeyUp(e){this.keys.set(e.key,!1),this.keysReleased.set(e.key,!0)}isKeyDown(e){return!!this.keys.get(e)}isKeyPressed(e){return!!this.keysPressed.get(e)}isKeyReleased(e){return!!this.keysReleased.get(e)}update(){this.keysPressed.clear(),this.keysReleased.clear()}};i(l,"instance");let c=l;class g{static checkCollision(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}static isPointInRect(e,t,s){return e>=s.x&&e<=s.x+s.width&&t>=s.y&&t<=s.y+s.height}static applyGravity(e,t,s){e.y+=t*s}static handleGroundCollision(e,t,s,r){return e.y+s>r?(e.y=r-s,t.y=0,!0):!1}}class y{constructor(e,t,s,r,n){i(this,"x");i(this,"y");i(this,"width");i(this,"height");i(this,"color");this.x=e,this.y=t,this.width=s,this.height=r,this.color=n}render(e){e.fillStyle=this.color,e.fillRect(this.x,this.y,this.width,this.height)}getRect(){return{x:this.x,y:this.y,width:this.width,height:this.height}}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}setPosition(e,t){this.x=e,this.y=t}}class w extends y{constructor(t,s,r,n,u){super(t,s,r,n,"#3498db");i(this,"velocity");i(this,"isJumping");i(this,"isOnGround");i(this,"jumpForce");i(this,"moveSpeed");i(this,"gravity");i(this,"groundY");this.velocity={x:0,y:0},this.isJumping=!1,this.isOnGround=!0,this.jumpForce=-550,this.moveSpeed=250,this.gravity=980,this.groundY=u}update(t){const s=c.getInstance();this.velocity.x=0,s.isKeyDown(a.LEFT)&&(this.velocity.x=-this.moveSpeed),s.isKeyDown(a.RIGHT)&&(this.velocity.x=this.moveSpeed),(s.isKeyPressed(a.UP)||s.isKeyPressed(a.SPACE))&&this.isOnGround&&(this.velocity.y=this.jumpForce,this.isJumping=!0,this.isOnGround=!1),g.applyGravity(this.velocity,this.gravity,t),this.x+=this.velocity.x*t,this.y+=this.velocity.y*t,this.y+this.height>this.groundY&&(this.y=this.groundY-this.height,this.velocity.y=0,this.isOnGround=!0,this.isJumping=!1),this.x<0&&(this.x=0)}isJumpingState(){return this.isJumping}getVelocityY(){return this.velocity.y}setVelocityY(t){this.velocity.y=t}setOnGround(t){this.isOnGround=t,t&&(this.isJumping=!1)}isOnGroundState(){return this.isOnGround}reset(t,s){this.x=t,this.y=s,this.velocity.x=0,this.velocity.y=0,this.isJumping=!1,this.isOnGround=!0}}class o extends y{constructor(e,t,s,r){super(e,t,s,r,"#27ae60")}update(e){}}class d extends y{constructor(e,t,s,r){super(e,t,s,r,"#e74c3c")}update(e){}}class v extends y{constructor(e,t,s,r){super(e,t,s,r,"#f1c40f")}update(e){}render(e){super.render(e),e.strokeStyle="#e67e22",e.lineWidth=2,e.strokeRect(this.x,this.y,this.width,this.height),e.fillStyle="#e67e22",e.beginPath(),e.arc(this.x+this.width/2,this.y+this.height/2,this.width/10,0,Math.PI*2),e.fill()}}class S{constructor(){i(this,"game",null);i(this,"player",null);i(this,"grounds",[]);i(this,"traps",[]);i(this,"treasure",null);i(this,"gameState",0);i(this,"startTime",0);i(this,"endTime",0);i(this,"cameraX",0);i(this,"levelWidth",3e3);i(this,"autoScrollSpeed",150);i(this,"retryKeyReleased",!0);i(this,"autoMoveSpeed",200)}init(e){this.game=e,this.startTime=performance.now(),this.gameState=0,this.cameraX=0,this.retryKeyReleased=!0;const s=e.getCanvas().height-50;this.player=new w(50,s-40,30,40,s),this.grounds=[],this.grounds.push(new o(0,s,500,50)),this.grounds.push(new o(600,s,400,50)),this.grounds.push(new o(1100,s,300,50)),this.grounds.push(new o(1500,s,200,50)),this.grounds.push(new o(1800,s,400,50)),this.grounds.push(new o(2300,s,700,50)),this.grounds.push(new o(550,s-100,100,20)),this.grounds.push(new o(1050,s-120,80,20)),this.grounds.push(new o(1450,s-150,70,20)),this.grounds.push(new o(1750,s-180,60,20)),this.traps=[],this.traps.push(new d(500,s-10,100,10)),this.traps.push(new d(1e3,s-10,100,10)),this.traps.push(new d(1400,s-10,100,10)),this.traps.push(new d(1700,s-10,100,10)),this.traps.push(new d(2200,s-10,100,10)),this.treasure=new v(2800,s-50,50,50)}update(e){const t=c.getInstance();if(this.gameState!==0){if(!t.isKeyDown(a.SPACE)&&!t.isKeyDown(a.UP)&&!t.isKeyDown(a.R)&&(this.retryKeyReleased=!0),this.retryKeyReleased&&(t.isKeyPressed(a.R)||t.isKeyPressed(a.SPACE)||t.isKeyPressed(a.UP))){this.gameState=0,this.reset(),t.update();return}t.isKeyPressed(a.ESC)&&this.game&&this.game.stop(),t.update();return}if(!this.player||!this.game)return;this.player.update(e);let s=!1;for(const n of this.grounds)if(this.player.getVelocityY()>0&&this.player.getY()+this.player.getHeight()>=n.getY()-5&&this.player.getY()+this.player.getHeight()<=n.getY()+10&&this.player.getX()+this.player.getWidth()>n.getX()&&this.player.getX()<n.getX()+n.getWidth()){this.player.setPosition(this.player.getX(),n.getY()-this.player.getHeight()),this.player.setVelocityY(0),this.player.setOnGround(!0),s=!0;break}!s&&!this.player.isOnGroundState()&&this.player.setOnGround(!1);for(const n of this.traps)if(g.checkCollision(this.player.getRect(),n.getRect())){this.gameState=1,this.endTime=performance.now(),this.retryKeyReleased=!1;return}if(this.treasure&&g.checkCollision(this.player.getRect(),this.treasure.getRect())){this.gameState=2,this.endTime=performance.now(),this.retryKeyReleased=!1;return}if(this.player.getY()>this.game.getCanvas().height){this.gameState=1,this.endTime=performance.now(),this.retryKeyReleased=!1;return}this.cameraX+=this.autoScrollSpeed*e;const r=this.cameraX+50;if(this.player.getX()<r&&this.player.setPosition(r,this.player.getY()),this.cameraX<0&&(this.cameraX=0),this.treasure&&this.cameraX>this.levelWidth-this.game.getCanvas().width-100){const n=this.player.getX()+this.autoMoveSpeed*e;this.player.setPosition(n,this.player.getY())}t.update()}render(e){if(!this.game)return;const t=this.game.getCanvas();e.fillStyle="#87CEEB",e.fillRect(0,0,t.width,t.height),e.save(),e.translate(-this.cameraX,0);for(const s of this.grounds)s.render(e);for(const s of this.traps)s.render(e);if(this.treasure&&this.treasure.render(e),this.player&&this.player.render(e),e.restore(),this.gameState===1&&(e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,t.width,t.height),e.fillStyle="#ffffff",e.font="36px Arial",e.textAlign="center",e.fillText("ゲームオーバー",t.width/2,t.height/2-40),e.font="24px Arial",e.fillText("スペースキーでリトライ",t.width/2,t.height/2+20)),this.gameState===2){const s=(this.endTime-this.startTime)/1e3;e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,t.width,t.height),e.fillStyle="#ffffff",e.font="36px Arial",e.textAlign="center",e.fillText("ゲームクリア！",t.width/2,t.height/2-60),e.font="24px Arial",e.fillText(`クリア時間: ${s.toFixed(2)}秒`,t.width/2,t.height/2),e.fillText("スペースキーでリトライ",t.width/2,t.height/2+40)}}reset(){this.game&&this.init(this.game)}}document.addEventListener("DOMContentLoaded",()=>{try{const h=new m("game-canvas"),e=new S;h.setScene(e),h.start(),console.log("ゲームが正常に開始されました")}catch(h){console.error("ゲームの初期化中にエラーが発生しました:",h)}});
